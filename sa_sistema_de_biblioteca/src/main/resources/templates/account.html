<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Biblioteca SENAI</title>

    <link rel="stylesheet" href="/css/geral.css" />
    <link rel="stylesheet" href="/css/loginBiblioteca.css" />

    <link rel="shortcut icon" href="https://estudante.sesisenai.org.br/img/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>

<body>
    <i onclick="window.location ='/home'" class="fa-solid fa-arrow-left"></i>

    <div class="left-side">
        <div class="senaiLogo">
            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
            <svg version="1.1" width="595.28009" height="841.89001" id="svg60" viewBox="0 0 595.28009 841.89001"
                sodipodi:docname="Senai - azul.svg" inkscape:version="1.1.2 (b8e25be833, 2022-02-05)"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg"
                xmlns:svg="http://www.w3.org/2000/svg">
                <defs id="defs64" />
                <sodipodi:namedview id="namedview62" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0"
                    inkscape:pageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" showgrid="false"
                    inkscape:zoom="0.74594065" inkscape:cx="38.877088" inkscape:cy="450.43798"
                    inkscape:window-width="1600" inkscape:window-height="837" inkscape:window-x="-8"
                    inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="Layer1001" />
                <g id="Layer1000" transform="translate(-30.833551,2.6811784)">
                    <g id="Layer1001" transform="translate(-45.580032,-105.90655)">
                        <path
                            d="M 616.35952,504.54918 639.99848,393.36592 H 609.19711 L 585.54729,504.54918 Z M 503.5675,461.27328 v 0 l 24.92578,-46.18761 h 0.4576 l 4.34724,46.18761 z m -24.27445,43.2759 v 0 l 11.85921,-21.72068 h 45.12743 l 2.75804,21.72068 h 34.81612 L 553.59477,393.36592 h -37.57416 l -67.52893,111.18326 z m -150.60865,0 v 0 h 27.72232 l 18.08531,-85.15601 h 0.31231 l 19.6447,85.15601 H 437.1 l 23.64051,-111.18326 h -27.70369 l -17.57834,82.5535 -0.35112,0.30269 -19.66488,-82.85619 h -43.11912 z m -17.40324,0 v 0 l 4.59902,-21.56484 h -53.90636 l 5.01875,-23.56165 h 49.57929 l 4.56983,-21.54466 h -49.58891 l 4.88215,-22.94821 h 53.88617 l 4.59902,-21.5639 h -84.6981 l -23.62064,111.18326 z m -89.08414,-78.53906 v 0 c 7.52222,-26.78786 -14.28446,-34.95427 -37.2426,-34.95427 -23.24034,0 -47.8833,7.24065 -54.70452,33.56997 -2.55377,12.01506 0.80779,22.17829 11.0002,27.10825 21.91596,10.62082 45.39938,7.38593 42.19335,22.4906 -1.56808,7.385 -11.4103,11.06974 -18.52335,11.06974 -11.07936,0 -17.56002,-5.69118 -15.21115,-16.1661 H 118.9259 c -5.96283,30.19692 15.24996,37.75888 41.10305,37.75888 25.71494,0 51.17656,-11.11817 56.16519,-34.52399 6.37231,-30.03144 -20.33545,-31.86341 -37.96284,-36.64808 -7.68894,-2.1536 -16.98538,-4.77504 -15.25959,-12.94083 1.15892,-5.5344 8.3117,-10.1536 15.38625,-10.1536 5.23265,0 8.98413,1.22752 11.10855,3.53759 2.28957,2.30913 2.98126,5.53347 1.93938,9.85184 z"
                            style="fill:#005caa;fill-rule:evenodd;stroke-width:3.10451;fill-opacity:1" id="path29" />
                    </g>
                </g>
            </svg>

        </div>
    </div>

    <div class="right-side">

        <input type="checkbox" id="chk" aria-hidden="true" />
        <div class="auth-container">
            <div class="signup">
                <form id="signup-form" action="/signup" method="POST">
                    <h1 for="chk" aria-hidden="true">Cadastrar</h1>
                    <p>Nome:</p>
                    <input type="text" name="name" placeholder="Nome completo" required />
                    <p>Email:</p>
                    <input type="email" name="email" placeholder="E-mail" required />
                    <p>Telefone:</p>
                    <input type="tel" name="phone" placeholder="Telefone" />
                    <p>Senha:</p>
                    <input type="password" name="password" placeholder="Senha" required />



                    <button type="submit">Cadastrar</button>
                    <label for="chk" aria-hidden="true">Login</label>
                </form>
            </div>

            <div class="login">
                <form action="/login" method="POST">
                    <h1>Faça seu login:</h1>

                    <input type="email" id="loginEmail" name="email" placeholder="E-mail" required />
                    <input type="password" id="loginPassword" name="password" placeholder="Senha" required />

                    <button id="submitLogin" type="submit">Entrar</button>
                    <label for="chk" aria-hidden="true">Cadastre-se</label>
                </form>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/just-validate@4.3.0/dist/just-validate.production.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const validator = new JustValidate('#signup-form');

            validator
                .addField('input[name="name"]', [
                    {
                        rule: 'required',
                        errorMessage: 'Nome é obrigatório',
                    },
                    {
                        rule: 'minLength',
                        value: 3,
                        errorMessage: 'Nome muito curto',
                    }
                ])
                .addField('input[name="email"]', [
                    {
                        rule: 'required',
                        errorMessage: 'E-mail é obrigatório',
                    },
                    {
                        rule: 'email',
                        errorMessage: 'E-mail inválido',
                    }
                ])
                .addField('input[name="password"]', [
                    {
                        rule: 'required',
                        errorMessage: 'Senha é obrigatória',
                    },
                    {
                        rule: 'minLength',
                        value: 6,
                        errorMessage: 'A senha deve ter pelo menos 6 caracteres',
                    }
                ])
                .onSuccess((event) => {
                    event.preventDefault();

                    const form = document.getElementById('signup-form');
                    const user = {
                        nome: form.querySelector('input[name="name"]').value,
                        email: form.querySelector('input[name="email"]').value,
                        telefone: form.querySelector('input[name="phone"]').value,
                        password: form.querySelector('input[name="password"]').value,
                    };

                    console.log('Usuário válido:', user);

                    cadastrar(user);


                    // Aqui você pode enviar os dados manualmente ou deixar o formulário enviar normalmente:
                    // form.submit();
                });
        });


        async function cadastrar(user) {
            const RESPONSE = await fetch("/user/create", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(user),
            });

            const RESPONSEDATA = await RESPONSE.json();

            alert("Cadastro feito com sucesso!")
            document.getElementById("chk").checked = false;
        }

        document.getElementById("submitLogin").addEventListener('click', ((event) => login(event)))

        async function login(event) {
            event.preventDefault();
            const userDTO = {
                email: document.getElementById("loginEmail").value,
                password: document.getElementById("loginPassword").value,
            };

            try {
                const RESPONSE = await fetch("/user/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(userDTO),
                });

                // Aqui você pega o status da resposta
                const statusCode = RESPONSE.status;

                // Pega os dados do corpo (se houver)
                const data = await RESPONSE.json();

                // Verifica status
                
                if (statusCode === 200) {
                    alert("Login feito com sucesso!");
                    
                    localStorage.setItem("idUser", data.idUser)
                    // Redirecionamento, armazenamento de token, etc.
                } else if (statusCode === 404) {
                    alert("Email não encontrado");
                } else if (statusCode === 401) {
                    alert("Senha incorreta");
                } else {
                    alert(`Erro inesperado (status ${statusCode})`);
                }
            } catch (error) {
                console.error("Erro na requisição:", error);
                alert("Erro ao tentar fazer login. Verifique sua conexão.");
            }
        }



    </script>


</body>

</html>